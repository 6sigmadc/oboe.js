<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="utf-8">
   <title>HTML5 boilerplate – all you really need…</title>

   <link rel="stylesheet" href="css/modularPageExample.css">
   <!--[if IE]>
   <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
   <![endif]-->


</head>

<body class="modularPage" ng-app>

   <h1>An example page modular webpage</h1>
   
   <h2 data-module="pageInfo">
      It doesn't really do anything but it looks like a lot of websites.
   </h2>
   
   <section>
      <section data-module="barChart">
         <header>Bar Chart</header>
         <p>Here is a bar chart with some bars on it:</p>
      </section>
      
      <section data-module="imageSlider">
         <header>Images</header>
         <p>Here are some images in a slider thing::</p>
      </section>
      
      <section data-module="map">
         <header>API Map</header>
         <p>Here is a map with some points loaded onto it:</p>
      </section>
   </section>
   
   <section data-module="tables" data-template="TableTemplate">
      <header>Table</header>
      <p>Here is a table:</p>
      <h2 class="data-cloak">{{heading}}</h2>      
           
      <table class="data-cloak">
         <tbody data-repeat="row in data">
            <tr><th>{{row.heading}}</th><td>{{row.value}}</td></tr>
         </tbody>
      </table>
   </section>

   <script src="modularPageExampleData.js" type="text/javascript" ></script>
   <script src="libs/soma-template.js" type="text/javascript" ></script>
   <script src="../oboe.js" type="text/javascript" ></script>
   <script>
      var parser = oboe.parser();            
   
      function renderTemplateWithNewData( template, scope, fieldName ) {
         return function(data) {
            scope[fieldName] = data;
            template.render();
         }
      }
   
      function TableTemplate(template, scope){
         parser.onFind({
         
            '$.table.heading' : renderTemplateWithNewData( template, scope, 'heading' )            
         ,  '$.table.data':     renderTemplateWithNewData( template, scope, 'data' )
         });         
      }
   
      function expandJsonTemplate( template ) {
                  
         return template;
         // TODO: expand examples out
         // TODO: ramdomise the order.
      }
      
      function loadThrottled(parser, exampleData) {
         parser.read(exampleData);
      }
   
      // some time later, let's start reading:
      window.setTimeout(function(){
         // pretend to fetch in the data:
         var exampleJsonResponse = JSON.stringify(expandJsonTemplate(dataTemplate));      
      
         loadThrottled(parser, exampleJsonResponse);
      }, 1000);
                  
   </script>

</body>
</html>