#!/bin/sh

# This script generates the markdown versions of the Javascript source so that
# Pandoc can later turn them into a PDF.

 
function copyToMd {
   source=$1
   destination=$2
   ommitpagebreak=$3
   
   touch $destination
   
   echo > $destination  
   
   if [ $ommitpagebreak -ne 1 ]
   then
      echo "\pagebreak" >> $destination      
   fi
          
   echo >> $destination         
   echo $source >> $destination
   echo "---" >> $destination
   echo >> $destination    
   
   echo "~~~~ {.javascript}" >> $destination
   cat ../src/$source >> $destination
   echo >> $destination
   echo "~~~~" >> $destination
   echo >> $destination         
}

cd ../src

SOURCE_APPENDIX_MARKDOWN_DIR=main/7b_Appendix_oboe_source

SRC_FILES=$(ls *.js | sort) 

cd ../writing

rm $SOURCE_APPENDIX_MARKDOWN_DIR/*.js.md

FIRST=1

for JS_FILE_NAME in $SRC_FILES; do
   MD_FILE=$SOURCE_APPENDIX_MARKDOWN_DIR/$JS_FILE_NAME.md
   
   echo "will package source for appendix $MD_FILE"

   copyToMd $JS_FILE_NAME $MD_FILE $FIRST  
   
   FIRST=0    
done